<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark light">
    <title>Hill's equations simulator</title>
    <link rel="stylesheet" href="/src/styles.css">
    <script type="importmap">
    {
      "imports": {
        "three": "/node_modules/three/build/three.module.js",
        "satellite.js": "/node_modules/satellite.js/dist/satellite.es.js"
      }
    }
    </script>
</head>
<body>
    <div id="container">
        <h1>🛰️ Hill's equations simulator</h1>
        
        <div id="canvas-container">
            <canvas id="canvas"></canvas>
            <div id="axes-info">
                <div class="axis-label" style="color: #ff6b6b">R軸: Radial (径方向 - 地心→衛星)</div>
                <div class="axis-label" style="color: #2ECC71">S軸: Along-track (軌道進行方向)</div>
                <div class="axis-label" style="color: #00BFFF">W軸: Cross-track (軌道面垂直方向)</div>
            </div>
            
            <!-- 折りたたみ可能な基準衛星情報パネル -->
            <div id="reference-satellite-panel">
                <button id="reference-satellite-toggle" class="panel-toggle" onclick="toggleReferenceSatelliteInfo()">
                    <span class="icon">🛰️</span>
                    <span class="toggle-arrow">▼</span>
                </button>
                <div id="reference-satellite-content" class="panel-content">
                    <div class="panel-column">
                        <div class="info-section">
                            <div class="panel-section-title">📍 位置情報</div>
                            <div id="geodetic-info" class="panel-info-content"></div>
                        </div>
                        <div class="info-section">
                            <div class="panel-section-title">🌍 ECI座標系</div>
                            <div id="eci-info" class="panel-info-content"></div>
                        </div>
                    </div>
                    <div class="panel-column">
                        <div class="info-section">
                            <div class="panel-section-title">🚀 軌道要素</div>
                            <div id="orbital-info" class="panel-info-content"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="time-display">
                <span id="simulationTime">00分00秒</span>
            </div>
            <button id="fullscreen-toggle" onclick="toggleFullscreen()" title="全画面表示">⛶</button>
        </div>
        
        <div id="controls">
            <div class="controls-grid">
                <!-- 衛星配置設定 -->
                <div class="control-section">
                    <h4 class="section-title">🛰️ 衛星配置</h4>
                    <div class="control-row compact">
                        <div class="control-group">
                            <label>配置:</label>
                            <select id="placementPattern">
                                <option value="axis">軸上-速度0</option>
                                <option value="grid">格子-速度0</option>
                                <option value="random_position">ランダム-速度0</option>
                                <option value="random_position_velocity">ランダム</option>
                                <option value="random_periodic">ランダム-周期解</option>
                                <option value="xy_ellipse">楕円軌道</option>
                                <option value="circular_orbit">円軌道</option>
                                <option value="hexagonal_disk">円盤軌道</option>
                                <option value="vbar_approach">V-bar軌道</option>
                                <option value="rbar_approach">R-bar軌道</option>
                            </select>
                        </div>
                        
                        <div class="control-group" id="satelliteCountControl">
                            <label>数:</label>
                            <input type="number" id="satelliteCount" min="1" max="5" value="1">
                        </div>
                    </div>
                    
                    <div class="control-row compact">
                        <div class="control-group">
                            <label>範囲(m):</label>
                            <input type="number" id="orbitRadius" min="0.1" max="10000" step="0.1" value="10">
                        </div>
                    </div>
                    
                    <div class="control-row compact">
                        <div class="control-group" id="zAmplitudeControl" style="display: none;">
                            <label>Z振幅:</label>
                            <input type="range" id="zAmplitude" min="-3" max="3" step="0.1" value="0">
                            <span id="zAmplitudeValue">0.0</span>A
                        </div>
                        <div class="control-group" id="circularZDirectionControl" style="display: none;">
                            <label>
                                <input type="checkbox" id="circularZDirection" checked>
                                +Z方向
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- シミュレーション制御 -->
                <div class="control-section">
                    <h4 class="section-title">⏱️ 制御</h4>
                    <div class="control-row compact">
                        <div class="control-group">
                            <label>倍速:</label>
                            <select id="timeScale">
                                <option value="1">1x</option>
                                <option value="2">2x</option>
                                <option value="5">5x</option>
                                <option value="10">10x</option>
                                <option value="20">20x</option>
                                <option value="50">50x</option>
                                <option value="100" selected>100x</option>
                                <option value="200">200x</option>
                                <option value="500">500x</option>
                                <option value="1000">1000x</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- 推力制御設定 -->
                    <div class="control-row compact">
                        <div class="control-group">
                            <label>推力量:</label>
                            <input type="number" id="thrustAmount" min="0.0001" max="1" step="0.0001" value="0.001">
                            <span>m/s</span>
                        </div>
                    </div>
                    
                    <!-- 摂動設定 -->
                    <div class="control-row compact">
                        <div class="control-group">
                            <label>摂動量:</label>
                            <input type="number" id="perturbationAmount" min="0.001" max="0.1" step="0.001" value="0.02">
                            <span>m/s</span>
                        </div>
                    </div>
                    
                    <div class="control-buttons compact">
                        <button onclick="resetSimulation()">🔄衛星初期化</button>
                        <button onclick="togglePause()">⏯️一時停止</button>
                        <button onclick="addPerturbation()">💥＋摂動</button>
                        <button onclick="resetView()">🎦視点リセット</button>
                    </div>
                </div>
                
                <!-- 表示設定 -->
                <div class="control-section">
                    <h4 class="section-title">👁️ 表示</h4>
                    
                    <!-- 3D空間の表示要素 -->
                    <div class="control-subsection">
                        <h5 class="subsection-title">🌌 3D空間</h5>
                        <div class="control-row compact">
                            <div class="control-group">
                                <input type="checkbox" id="showGrid" checked>
                                <label>グリッド</label>
                            </div>
                            <div class="control-group">
                                <input type="checkbox" id="showEarth" checked>
                                <label>地球</label>
                            </div>
                        </div>
                        
                        <div class="control-row compact">
                            <div class="control-group">
                                <label>地球テクスチャ:</label>
                                <select id="earthTexture">
                                    <option value="earth00.webp">通常</option>
                                    <option value="earth01.webp">夜景</option>
                                    <option value="earth02.webp">地形</option>
                                    <option value="earth03.webp">標準</option>
                                    <option value="earth04.webp">衛星画像</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 衛星の表示設定 -->
                    <div class="control-subsection">
                        <h5 class="subsection-title">🛰️ 衛星</h5>
                        <div class="control-row compact">
                            <div class="control-group">
                                <label>サイズ:</label>
                                <input type="number" id="satelliteSize" min="0.1" max="100" step="0.1" value="0.8">
                                <span>px</span>
                            </div>
                        </div>
                        
                        <div class="control-row compact">
                            <div class="control-group">
                                <label>形状:</label>
                                <select id="satelliteShape">
                                    <option value="sphere">球体</option>
                                    <option value="cube">立方体</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="control-row compact">
                            <div class="control-group">
                                <input type="checkbox" id="uniformSatelliteColor">
                                <label>色を統一</label>
                            </div>
                            <div class="control-group">
                                <label>色:</label>
                                <input type="color" id="satelliteColor" value="#ffffff">
                            </div>
                        </div>
                    </div>

                    <!-- 軌跡の表示設定 -->
                    <div class="control-subsection">
                        <h5 class="subsection-title">📈 軌跡</h5>
                        <div class="control-row compact">
                            <div class="control-group">
                                <input type="checkbox" id="showTrails" checked>
                                <label>軌跡を表示</label>
                            </div>
                        </div>
                        
                        <div class="control-row compact">
                            <div class="control-group">
                                <label>軌跡長:</label>
                                <input type="range" id="trailLength" min="50" max="500" step="50" value="200">
                                <span id="trailLengthValue">200</span>
                                <span>点</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 基準軌道設定 -->
                <div class="control-section">
                    <h4 class="section-title collapsible" onclick="toggleSection('orbit-controls')">🌍 基準軌道 <span class="toggle-icon">▼</span></h4>
                    <div id="orbit-controls" class="collapsible-content" style="display: none;">
                    <div class="control-row compact">
                        <div class="control-group">
                            <label>軌道傾斜角(°):</label>
                            <input type="number" id="inclination" min="0" max="180" step="0.1" value="51.6">
                        </div>
                        
                        <div class="control-group">
                            <label>昇交点経度(°):</label>
                            <input type="number" id="raan" min="0" max="360" step="0.1" value="0">
                        </div>
                    </div>
                    
                    <div class="control-row compact">
                        <div class="control-group">
                            <label>離心率:</label>
                            <input type="number" id="eccentricity" min="0" max="0.99" step="0.001" value="0">
                        </div>
                        
                        <div class="control-group">
                            <label>近地点引数(°):</label>
                            <input type="number" id="argOfPerigee" min="0" max="360" step="0.1" value="0">
                        </div>
                    </div>
                    
                    <div class="control-row compact">
                        <div class="control-group">
                            <label>平均近点角(°):</label>
                            <input type="number" id="meanAnomaly" min="0" max="360" step="0.1" value="0">
                        </div>
                        
                        <div class="control-group">
                            <label>高度(km):</label>
                            <input type="number" id="orbitAltitude" min="200" max="36000" step="50" value="500">
                        </div>
                    </div>
                    
                    <div id="orbitInfo" class="orbit-info">
                        <!-- 軌道情報がここに表示される -->
                    </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="plots-container">
            <h2>📈 2D投影図</h2>
            <div class="plots-row">
                <div class="plot-wrapper">
                    <h3>RS平面 (動径-進行方向)</h3>
                    <canvas id="plot-xy" width="300" height="300"></canvas>
                </div>
                <div class="plot-wrapper">
                    <h3>RW平面 (動径-軌道面垂直)</h3>
                    <canvas id="plot-xz" width="300" height="300"></canvas>
                </div>
                <div class="plot-wrapper">
                    <h3>SW平面 (進行-軌道面垂直)</h3>
                    <canvas id="plot-yz" width="300" height="300"></canvas>
                </div>
            </div>
        </div>

        <div id="info">
            <strong>📊 ヒルの方程式について:</strong><br>
            ヒルの方程式は、円軌道上の主衛星に対する近傍衛星の相対運動を記述します。
            この3D可視化では、中心の白い衛星を基準とした相対座標系（LVLH座標系）で他の衛星の動きを表示しています。
            マウスドラッグで視点を回転、スクロールやピンチ操作でズームできます。
            <br><br>
            <strong>🚀 実用軌道パターン:</strong><br>
            <strong>円軌道:</strong> 編隊飛行で利用。<br>
            <strong>V-bar軌道:</strong> 宇宙ステーションの後方（速度ベクトル方向）から接近する安全な軌道。SpaceX DragonやSoyuz宇宙船が使用。<br>
            <strong>R-bar軌道:</strong> 宇宙ステーションの下方（径方向）から接近する直接的な軌道。精密な制御が必要。
            <br><br>
            <strong>⌨️ キーボードショートカット:</strong> Hキーでヘルプ表示
        </div>
        

    </div>

    <script type="module" src="/src/main.ts"></script>
</body>
</html>