<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="color-scheme" content="dark light">
    <title>Relative motion equations simulator</title>
    <link rel="stylesheet" href="/src/styles.css">
    <script type="importmap">
    {
      "imports": {
        "three": "/node_modules/three/build/three.module.js",
        "satellite.js": "/node_modules/satellite.js/dist/satellite.es.js"
      }
    }
    </script>
</head>
<body>
    <div id="container">
        <h1>ğŸ›°ï¸ Relative motion equations simulator</h1>
        
        <div id="canvas-container">
            <!-- ãƒˆãƒƒãƒ—ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãƒ¼ -->
            <div id="top-controls">
                <!-- ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ -->
                <button id="hamburger-menu" class="hamburger-button" onclick="toggleSidebar()">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
                <div class="quick-actions">
                    <button class="action-button" onclick="resetSimulation()" title="è¡›æ˜Ÿã‚’åˆæœŸä½ç½®ã«æˆ»ã™">
                        <span class="button-icon">ğŸ›°ï¸ğŸ”„</span>
                    </button>
                    <button class="action-button" onclick="resetView()" title="ã‚«ãƒ¡ãƒ©ã‚’åˆæœŸä½ç½®ã«æˆ»ã™">
                        <span class="button-icon">ğŸ¥ğŸ”„</span>
                    </button>
                </div>
            </div>
            
            <!-- è¡›æ˜Ÿé…ç½®ãƒ‘ãƒãƒ« -->
            <div id="satellite-config-panel">
                <div class="panel-header" onclick="toggleSatelliteConfig()">
                    <h4 class="section-title">ğŸ›°ï¸ è¡›æ˜Ÿé…ç½®</h4>
                    <span id="satellite-config-toggle" class="toggle-icon">â–¼</span>
                </div>
                <div id="satellite-config-content" class="panel-content">
                        <div class="control-group">
                            <label>é…ç½®:</label>
                            <select id="placementPattern">
                                <option value="axis">è»¸ä¸Š-é€Ÿåº¦0</option>
                                <option value="grid">æ ¼å­-é€Ÿåº¦0</option>
                                <option value="random_position">ãƒ©ãƒ³ãƒ€ãƒ -é€Ÿåº¦0</option>
                                <option value="random_position_velocity">ãƒ©ãƒ³ãƒ€ãƒ </option>
                                <option value="random_periodic">ãƒ©ãƒ³ãƒ€ãƒ -å‘¨æœŸè§£</option>
                                <option value="periodic_orbit">æ¥•å††è»Œé“</option>
                                <option value="circular_orbit">å††è»Œé“</option>
                                <option value="hexagonal_disk">å††ç›¤è»Œé“</option>
                                <option value="vbar_approach">V-barè»Œé“</option>
                                <option value="rbar_approach">R-barè»Œé“</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>æ•°:</label>
                            <input type="number" id="satelliteCount" min="1" max="5" value="1">
                        </div>
                        <div class="control-group">
                            <label>ç¯„å›²(m):</label>
                            <input type="number" id="orbitRadius" min="0.1" max="10000" step="0.1" value="10">
                        </div>
                    <div id="zAmplitudeControl" style="display: none;">
                        <div class="control-group">
                            <label>ZæŒ¯å¹…:</label>
                            <input type="range" id="zAmplitude" min="-3" max="3" step="0.1" value="0">
                            <span id="zAmplitudeValue">0.0</span>A
                        </div>
                    </div>
                    <div id="periodicParamsControl" style="display: none;">
                        <h5>æ¥•å††è§£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ (A=ç¯„å›²ã€B~F=Aæ¯”)</h5>
                        <div class="periodic-params-grid">
                            <div class="param-item">
                                <label>B/A:</label>
                                <input type="range" id="paramB" min="-3" max="3" step="0.1" value="0">
                                <span id="paramBValue">0.0</span>
                            </div>
                            <div class="param-item">
                                <label>D/A:</label>
                                <input type="range" id="paramD" min="-3" max="3" step="0.1" value="0">
                                <span id="paramDValue">0.0</span>
                            </div>
                            <div class="param-item">
                                <label>E/A:</label>
                                <input type="range" id="paramE" min="-3" max="3" step="0.1" value="0">
                                <span id="paramEValue">0.0</span>
                            </div>
                            <div class="param-item">
                                <label>F/A:</label>
                                <input type="range" id="paramF" min="-3" max="3" step="0.1" value="0">
                                <span id="paramFValue">0.0</span>
                            </div>
                        </div>
                        <div id="eccentricityDisplay" class="eccentricity-info">
                            <span class="eccentricity-label">é›¢å¿ƒç‡ e:</span>
                            <span id="eccentricityValue">0.00</span>
                        </div>
                    </div>
                    <div id="circularZDirectionControl" style="display: none;">
                        <div class="control-group">
                            <input type="checkbox" id="circularZDirection" checked>
                            <label>+Zæ–¹å‘</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
            <div id="sidebar" class="sidebar">
                <div class="sidebar-header">
                    <h3>è¨­å®š</h3>
                    <button class="close-button" onclick="toggleSidebar()">Ã—</button>
                </div>
                <div class="sidebar-content">
                    <!-- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡ -->
                    <div class="subsection">
                        <h5 class="subsection-title">âš¡ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h5>
                        <div class="control-row">
                            <div class="control-group" style="flex: 1;">
                                <label>æ¨åŠ›:</label>
                                <input type="number" id="thrustAmount" min="0.0001" max="1" step="0.0001" value="0.001" style="width: 70px;">
                                <span style="font-size: 11px;">m/s</span>
                            </div>
                            <div class="control-group" style="flex: 1;">
                                <label>æ‘‚å‹•:</label>
                                <input type="number" id="perturbationAmount" min="0.001" max="0.1" step="0.001" value="0.02" style="width: 70px;">
                                <span style="font-size: 11px;">m/s</span>
                            </div>
                        </div>
                        <div class="control-buttons">
                            <button onclick="addPerturbation()" style="font-size: 12px; padding: 6px 12px;">ğŸ’¥æ‘‚å‹•</button>
                        </div>
                    </div>
            
                    <!-- 3Dç©ºé–“ã‚µãƒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div class="subsection">
                        <h5 class="subsection-title">ğŸŒŒ 3Dç©ºé–“è¡¨ç¤º</h5>
                        <div class="control-row">
                            <div class="control-group" style="flex: 1;">
                                <input type="checkbox" id="showGrid" checked>
                                <label style="min-width: auto;">ã‚°ãƒªãƒƒãƒ‰</label>
                            </div>
                            <div class="control-group" style="flex: 1;">
                                <input type="checkbox" id="showEarth" checked>
                                <label style="min-width: auto;">åœ°çƒ</label>
                            </div>
                            <div class="control-group" style="flex: 2;">
                                <select id="earthTexture" style="width: 100%;">
                                    <option value="earth00.webp">ã‚·ãƒ³ãƒ—ãƒ«</option>
                                    <option value="earth01.webp">æ¨™æº–</option>
                                    <option value="earth03.webp">æ·¡ç™½</option>
                                    <option value="earth04.webp">ãƒ–ãƒ«ãƒ¼ãƒãƒ¼ãƒ–ãƒ«</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è¡›æ˜Ÿã‚µãƒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div class="subsection">
                        <h5 class="subsection-title">ğŸ›°ï¸ è¡›æ˜Ÿè¡¨ç¤º</h5>
                        <div class="control-row">
                            <div class="control-group" style="flex: 1;">
                                <label>ã‚µã‚¤ã‚º:</label>
                                <input type="number" id="satelliteSize" min="0.1" max="100" step="0.1" value="0.8" style="width: 50px;">
                                <span style="font-size: 11px;">px</span>
                            </div>
                            <div class="control-group" style="flex: 1;">
                                <label>å½¢çŠ¶:</label>
                                <select id="satelliteShape" style="width: 80px;">
                                    <option value="sphere">çƒä½“</option>
                                    <option value="cube">ç«‹æ–¹ä½“</option>
                                </select>
                            </div>
                        </div>
                        <div class="control-row">
                            <div class="control-group" style="flex: 1;">
                                <input type="checkbox" id="uniformSatelliteColor">
                                <label style="min-width: auto;">è‰²ã‚’çµ±ä¸€</label>
                            </div>
                            <div class="control-group" style="flex: 1;">
                                <input type="color" id="satelliteColor" value="#ffffff" style="width: 50px;">
                            </div>
                        </div>
                        <div class="control-row">
                            <div class="control-group" style="flex: 1;">
                                <input type="checkbox" id="showTrails" checked>
                                <label style="min-width: auto;">è»Œè·¡è¡¨ç¤º</label>
                            </div>
                            <div class="control-group" style="flex: 2;">
                                <label>è»Œè·¡é•·ã•:</label>
                                <input type="range" id="trailLength" min="50" max="500" step="50" value="200" style="width: 80px;">
                                <span id="trailLengthValue" style="font-size: 11px;">200</span>
                            </div>
                        </div>
                    </div>
            
                    <!-- åŸºæº–è»Œé“ -->
                    <div class="sidebar-section">
                        <div class="sidebar-section-header" onclick="toggleSidebarSection('reference-orbit')">
                            <span class="section-icon">ğŸŒ</span>
                            <h4 class="section-title">åŸºæº–è»Œé“</h4>
                            <span id="reference-orbit-toggle" class="section-toggle">â–¶</span>
                        </div>
                        <div id="reference-orbit" class="sidebar-section-content collapsed">
                            <div class="control-row">
                                <div class="control-group">
                                    <label>è»Œé“å‚¾æ–œè§’(Â°):</label>
                                    <input type="number" id="inclination" min="0" max="180" step="0.1" value="51.6">
                                </div>
                            </div>
                            <div class="control-row">
                                <div class="control-group">
                                    <label>æ˜‡äº¤ç‚¹çµŒåº¦(Â°):</label>
                                    <input type="number" id="raan" min="0" max="360" step="0.1" value="0">
                                </div>
                            </div>
                            <div class="control-row">
                                <div class="control-group">
                                    <label>è¿‘åœ°ç‚¹å¼•æ•°(Â°):</label>
                                    <input type="number" id="argOfPerigee" min="0" max="360" step="0.1" value="0">
                                </div>
                            </div>
                            <div class="control-row">
                                <div class="control-group">
                                    <label>å¹³å‡è¿‘ç‚¹è§’(Â°):</label>
                                    <input type="number" id="meanAnomaly" min="0" max="360" step="0.1" value="0">
                                </div>
                            </div>
                            <div class="control-row">
                                <div class="control-group">
                                    <label>é«˜åº¦(km):</label>
                                    <input type="number" id="orbitAltitude" min="200" max="36000" step="50" value="500">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <canvas id="canvas"></canvas>
            <div id="axes-info">
                <div class="axis-label" style="color: #ff6b6b">Rè»¸: Radial (å¾„æ–¹å‘ - åœ°å¿ƒâ†’è¡›æ˜Ÿ)</div>
                <div class="axis-label" style="color: #2ECC71">Sè»¸: Along-track (è»Œé“é€²è¡Œæ–¹å‘)</div>
                <div class="axis-label" style="color: #00BFFF">Wè»¸: Cross-track (è»Œé“é¢å‚ç›´æ–¹å‘)</div>
            </div>
            
            <!-- æŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ãªåŸºæº–è¡›æ˜Ÿæƒ…å ±ãƒ‘ãƒãƒ« -->
            <div id="reference-satellite-panel">
                <button id="reference-satellite-toggle" class="panel-toggle" onclick="toggleReferenceSatelliteInfo()">
                    <span class="icon">ğŸ›°ï¸</span>
                    <span class="toggle-arrow">â–¼</span>
                </button>
                <div id="reference-satellite-content" class="panel-content">
                    <div class="panel-column">
                        <div class="info-section">
                            <div class="panel-section-title">ğŸ“ ä½ç½®æƒ…å ±</div>
                            <div id="geodetic-info" class="panel-info-content"></div>
                        </div>
                        <div class="info-section">
                            <div class="panel-section-title">ğŸŒ ECIåº§æ¨™ç³»</div>
                            <div id="eci-info" class="panel-info-content"></div>
                        </div>
                    </div>
                    <div class="panel-column">
                        <div class="info-section">
                            <div class="panel-section-title">ğŸš€ è»Œé“è¦ç´ </div>
                            <div id="orbital-info" class="panel-info-content"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ™‚é–“åˆ¶å¾¡ãƒ‘ãƒãƒ« -->
            <div id="time-controls-panel">
                <div id="time-scale-control">
                    <span class="icon">â±ï¸</span>
                    <select id="timeScale">
                        <option value="1">1x</option>
                        <option value="2">2x</option>
                        <option value="5">5x</option>
                        <option value="10">10x</option>
                        <option value="20">20x</option>
                        <option value="50">50x</option>
                        <option value="100" selected>100x</option>
                        <option value="200">200x</option>
                        <option value="500">500x</option>
                        <option value="1000">1000x</option>
                    </select>
                </div>
                <div id="time-display" onclick="togglePause()" title="ã‚¯ãƒªãƒƒã‚¯ã§ä¸€æ™‚åœæ­¢/å†é–‹">
                    <span id="simulationTime">00åˆ†00ç§’</span>
                </div>
            </div>
            
        </div>
        
        

        

    </div>

    <script type="module" src="/src/main.ts"></script>
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const hamburger = document.getElementById('hamburger-menu');
            sidebar.classList.toggle('open');
            hamburger.classList.toggle('active');
        }
        
        function toggleSidebarSection(sectionId) {
            const section = document.getElementById(sectionId);
            const toggle = document.getElementById(sectionId + '-toggle');
            section.classList.toggle('collapsed');
            toggle.textContent = section.classList.contains('collapsed') ? 'â–¶' : 'â–¼';
        }
        
        function toggleSatelliteConfig() {
            const content = document.getElementById('satellite-config-content');
            const toggle = document.getElementById('satellite-config-toggle');
            
            if (content.style.display === 'none' || !content.style.display) {
                content.style.display = 'block';
                toggle.textContent = 'â–¼';
            } else {
                content.style.display = 'none';
                toggle.textContent = 'â–¶';
            }
        }
        
        // ã‚µã‚¤ãƒ‰ãƒãƒ¼å¤–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«é–‰ã˜ã‚‹
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const hamburger = document.getElementById('hamburger-menu');
            if (sidebar.classList.contains('open') && 
                !sidebar.contains(event.target) && 
                !hamburger.contains(event.target)) {
                sidebar.classList.remove('open');
                hamburger.classList.remove('active');
            }
        });
    </script>
</body>
</html>